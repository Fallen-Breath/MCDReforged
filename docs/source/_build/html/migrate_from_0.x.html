

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Migrate from MCDR 0.x &mdash; MCDReforged 1.0.0 文档</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="prev" title="Info Reactor" href="customize/reactor.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MCDReforged
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Home</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure.html">Configure</a></li>
<li class="toctree-l1"><a class="reference internal" href="permission.html">Permission</a></li>
<li class="toctree-l1"><a class="reference internal" href="command.html">Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin_dev/plugin_dev.html">Plugin Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="customize/customize.html">Customize</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Migrate from MCDR 0.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#file-structure">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#config">Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="#permission">Permission</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plugins">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metadata">Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listener">Listener</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#compatibility">Compatibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listener-arguments">Listener arguments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multi-threading">Multi-threading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-location">Package location</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-instance-api">Server Instance API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#others">Others</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#console-command-prefix">console_command_prefix</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MCDReforged</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Migrate from MCDR 0.x</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/migrate_from_0.x.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="migrate-from-mcdr-0-x">
<h1>Migrate from MCDR 0.x<a class="headerlink" href="#migrate-from-mcdr-0-x" title="永久链接至标题">¶</a></h1>
<div class="section" id="file-structure">
<h2>File structure<a class="headerlink" href="#file-structure" title="永久链接至标题">¶</a></h2>
<p>Since MCDR now is installed as a python package, unless you run MCDR with source, file / folders below can be removed</p>
<ul class="simple">
<li><p>utils/</p></li>
<li><p>resources/</p></li>
<li><p>requirements.txt</p></li>
<li><p>LICENSE</p></li>
<li><p>readme.md</p></li>
<li><p>readme_cn.md</p></li>
<li><p>MCDReforged.py (If you still want to use it you can grab it from github release, it’s just an entry script)</p></li>
</ul>
<p>The logging folder is renamed from <code class="docutils literal notranslate"><span class="pre">log/</span></code> to <code class="docutils literal notranslate"><span class="pre">logs/</span></code></p>
</div>
<div class="section" id="config">
<h2>Config<a class="headerlink" href="#config" title="永久链接至标题">¶</a></h2>
<p>There come quite a lot of changes to the config file. Although MCDR will still work if you keep the old config file, it’s highly recommend to make a new default configure file, and fill your old configures into the new configure file</p>
<p>You can rename the old <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> to a temporary name like <code class="docutils literal notranslate"><span class="pre">old_config.yml</span></code>, then start MCDR. MCDR will generate a new default configure file and exit. Then open these 2 configure file and migrate</p>
</div>
<div class="section" id="permission">
<h2>Permission<a class="headerlink" href="#permission" title="永久链接至标题">¶</a></h2>
<p>There’s no change to the permission system and the permission file, so you can just use the old permission file</p>
</div>
<div class="section" id="plugins">
<h2>Plugins<a class="headerlink" href="#plugins" title="永久链接至标题">¶</a></h2>
<p>Most of the MCDR 0.x plugins only need to have some small changes to be adjusted to current MCDR. Some of them can even directly work with current MCDR without any change</p>
<div class="section" id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="永久链接至标题">¶</a></h3>
<p>Metadata is a global field inside the plugin file. It’s used to store basic information and dependencies of a plugin. It’s necessary for a plugin to declare it so MCDR can handle all the plugins correctly</p>
<p>A legacy plugin is still able to be loaded if it doesn’t have the metadata field, but a warning will be shown in the console</p>
<p>Check <a class="reference external" href="plugin_dev/basic.html#metadata">here</a> for more information about plugin metadata</p>
</div>
<div class="section" id="listener">
<h3>Listener<a class="headerlink" href="#listener" title="永久链接至标题">¶</a></h3>
<div class="section" id="compatibility">
<h4>Compatibility<a class="headerlink" href="#compatibility" title="永久链接至标题">¶</a></h4>
<p>Current MCDR implements a better event &amp; listener system, plugin can register any callback as event listener to any event.</p>
<p>Most of the MCDR 0.x style event listeners are reserved and now work as an automatically registered default listener for the related event</p>
<ul class="simple">
<li><p>on_info</p></li>
<li><p>on_user_info</p></li>
<li><p>on_server_startup</p></li>
<li><p>on_server_stop</p></li>
<li><p>on_mcdr_stop</p></li>
<li><p>on_player_joined</p></li>
<li><p>on_player_left</p></li>
</ul>
<p>If you declare a function with name above, MCDR will automatically detect it and register it as an event listener when your plugin gets loaded. The listener priority is the default value <code class="docutils literal notranslate"><span class="pre">1000</span></code></p>
<p>These 2 events are removed from MCDR</p>
<ul class="simple">
<li><p>on_death_message</p></li>
<li><p>on_player_made_advancement</p></li>
</ul>
<p>If your plugin relies on these 2 events, there is an alternative for it: <a class="reference external" href="#TODO">coming-soon</a></p>
</div>
<div class="section" id="listener-arguments">
<h4>Listener arguments<a class="headerlink" href="#listener-arguments" title="永久链接至标题">¶</a></h4>
<p>In MCDR 0.x the player joined event listener accepts 2 or 3 arguments. Both of these 2 definitions below work</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_player_joined</span><span class="p">(</span><span class="n">server</span><span class="p">:</span> <span class="n">ServerInterface</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_player_joined</span><span class="p">(</span><span class="n">server</span><span class="p">:</span> <span class="n">ServerInterface</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">Info</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>However, the former usage is removed in current MCDR version, only the latter one with 3 arguments is accepted</p>
<p>Beside the player joined event listener, other event listener callbacks have their argument list unchanged</p>
</div>
</div>
<div class="section" id="multi-threading">
<h3>Multi-threading<a class="headerlink" href="#multi-threading" title="永久链接至标题">¶</a></h3>
<p>MCDR 0.x allocates separate threads for plugins to execute their event listener callbacks. This lazyness brings unpredictable plugin execution order and affects overall performance by a lot. Multithreading also make it hard to do something after all plugins have finished their callbacks</p>
<p>In current MCDR, all event listeners callbacks are invoked in a single thread named <code class="docutils literal notranslate"><span class="pre">TaskExecutor</span></code> to solve the issues above</p>
<p>If your plugin depends on multithreading from MCDR to do some parallel operations, or your plugin need to do some I/O or network operations which might take some times, you’d better create a new thread to execute them manually, so MCDR won’t be blocked by these</p>
<p>MCDR also provides a simple function decorator <code class="docutils literal notranslate"><span class="pre">new_thread</span></code> for lazy man, to make a function multi threaded when being invoked. Here’s an quick example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mcdreforged.api.decorator</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># undecorated function</span>
<span class="k">def</span> <span class="nf">my_slow_method1</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="nd">@new_thread</span>  <span class="c1"># decorated function, will run at a new thread</span>
<span class="k">def</span> <span class="nf">my_slow_method2</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="nd">@new_thread</span><span class="p">(</span><span class="s1">&#39;MyThread&#39;</span><span class="p">)</span>  <span class="c1"># specify the thread name</span>
<span class="k">def</span> <span class="nf">my_slow_method3</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">&#64;new_thread</span></code> decorator, everytime when you invoke <code class="docutils literal notranslate"><span class="pre">my_slow_method2</span></code>, a new daemon thread will be started to executed it. For more details about the <code class="docutils literal notranslate"><span class="pre">&#64;new_thread</span></code> decorator, check <a class="reference external" href="plugin_dev/api.html#new-thread">here</a></p>
</div>
<div class="section" id="package-location">
<h3>Package location<a class="headerlink" href="#package-location" title="永久链接至标题">¶</a></h3>
<p>If your plugin imports some of the mcdr utils, like <code class="docutils literal notranslate"><span class="pre">RText</span></code> or <code class="docutils literal notranslate"><span class="pre">Rcon</span></code>, you need to take a look at the package location</p>
<p>Current MCDR collects all useful classes / functions in the <code class="docutils literal notranslate"><span class="pre">mcdreforged.api</span></code> package. It’s recommended to import the package you want in this <code class="docutils literal notranslate"><span class="pre">api</span></code> package</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">mcdreforged.api.rtext</span> <span class="pre">import</span> <span class="pre">*</span></code> if you want to use all rtext classes</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">mcdreforged.api.rcon</span> <span class="pre">import</span> <span class="pre">*</span></code> if you want to use all rcon classes. Class <code class="docutils literal notranslate"><span class="pre">Rcon</span></code> is renamed to <code class="docutils literal notranslate"><span class="pre">RconConnection</span></code> by the way</p>
<p>For lazy man, you can safely use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">mcdreforged.api.all</span> <span class="pre">import</span> <span class="pre">*</span></code> to import all useful things to the plugin</p>
</div>
<div class="section" id="server-instance-api">
<h3>Server Instance API<a class="headerlink" href="#server-instance-api" title="永久链接至标题">¶</a></h3>
<p>Method <code class="docutils literal notranslate"><span class="pre">reply</span></code> now raises a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> if the given <em>info</em> parameter is not from a user</p>
<p>Method <code class="docutils literal notranslate"><span class="pre">add_help_message</span></code> is renamed to <code class="docutils literal notranslate"><span class="pre">register_help_message</span></code></p>
</div>
<div class="section" id="others">
<h3>Others<a class="headerlink" href="#others" title="永久链接至标题">¶</a></h3>
<div class="section" id="console-command-prefix">
<h4>console_command_prefix<a class="headerlink" href="#console-command-prefix" title="永久链接至标题">¶</a></h4>
<p>The option <code class="docutils literal notranslate"><span class="pre">console_command_prefix</span></code> is removed, which was used to prevent input starts with <code class="docutils literal notranslate"><span class="pre">!!</span></code> to be sent to the standard input stream of the server by default</p>
<p>In current version, MCDR will not prevent that kind of console input to be sent to the server unless it matches an registered command tree root node. See how the current command system works <a class="reference external" href="plugin_dev/command.html#workflow">here</a></p>
<p>As a result, if you plugin use manually parsing method to parse command to parse a user command in <code class="docutils literal notranslate"><span class="pre">on_user_info</span></code> etc., you need to invoke <code class="docutils literal notranslate"><span class="pre">info.cancel_send_to_server()</span></code> in your command processing, otherwise if the command you enter on console might be sent to the server standard input stream</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="customize/reactor.html" class="btn btn-neutral float-left" title="Info Reactor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, Fallen_Breath.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>